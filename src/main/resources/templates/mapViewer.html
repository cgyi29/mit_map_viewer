<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/html" lang="en">
    <th:head>
        <script th:inline="javascript">
            async function drawPolygon(){
                const response = await fetch('/mapData/KoyMahalle');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const polygonDatas = await shapeData.polyTypeDatas;
                const mapCanvas = await document.getElementById('polygonMapCanvas');
                const ctx = await mapCanvas.getContext('2d');

                if(mapCanvas.getContext){
                    polygonDatas.forEach(function(polygonData){
                        polygonData.parts.forEach(function() {
                            ctx.beginPath();
                            drawLine(polygonData.points, bbox, mapCanvas, ctx);
                            ctx.fillStyle = "yellow";
                            ctx.fill();
                            ctx.stroke();
                        });
                    });
                }
            }

            async function drawPolyLine(){
                const response = await fetch('/mapData/Hatlar');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const polyLineDatas = await shapeData.polyTypeDatas;
                const mapCanvas = await document.getElementById('polyLineMapCanvas');
                const ctx = await mapCanvas.getContext('2d');

                if(mapCanvas.getContext){
                    polyLineDatas.forEach(function(polylineData){
                        polylineData.parts.forEach(function() {
                            ctx.beginPath();
                            drawLine(polylineData.points, bbox, mapCanvas, ctx);
                            ctx.stroke();
                        });
                    });
                }
            }

            async function drawPoint(){
                const response = await fetch('/mapData/Duraklar');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const points = await shapeData.points;

                const mapCanvas = document.getElementById('pointMapCanvas');
                if(mapCanvas.getContext){
                    const ctx = mapCanvas.getContext('2d');
                    points.forEach(point => {
                        let trPoint = scalePoint(point.x, point.y, bbox, mapCanvas);
                        ctx.beginPath();
                        ctx.arc(trPoint.x, trPoint.y, 2, 0, 2 * Math.PI);
                        ctx.fill();
                    });
                }
            }

            function scalePoint(x, y, bbox, canvas){
                let transformX = ((bbox.maxX - x) / (bbox.maxX - bbox.minX)) * canvas.width;
                let transformY = ((bbox.maxY - y) / (bbox.maxY - bbox.minY)) * canvas.height;
                transformX = canvas.width - transformX;
                return {x : transformX, y: transformY};
            }

            function drawLine(points, bbox, canvas, ctx){
                points.forEach((start, index) => {
                    let point = scalePoint(points[index].x, points[index].y, bbox, canvas);
                    if (index === 0) {
                        ctx.moveTo(point.x, point.y);
                    } else {
                        ctx.lineTo(point.x, point.y);
                    }
                });
            }

            window.onload = drawPoint();
            window.onload = drawPolygon();
            window.onload = drawPolyLine();
        </script>
    </th:head>
    <th:body>
        <canvas id="pointMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
        <canvas id="polyLineMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
        <canvas id="polygonMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
    </th:body>

</html>