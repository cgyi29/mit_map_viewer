<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/html" lang="en">
    <th:head>
        <script th:inline="javascript">
            async function drawPolygon(){
                const response = await fetch('/mapData/KoyMahalle');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const recordBbox = await shapeData.recordBboxs;
                const coordinates = await [shapeData.polyCoordinates];

                const mapCanvas = document.getElementById('polygonMapCanvas');
                const ctx = mapCanvas.getContext('2d');

                if(mapCanvas.getContext){
                    coordinates.forEach(coordinate => {
                        ctx.beginPath();
                        let  trPoint= transformCoordinates(coordinate[0][0], coordinate[0][1], bbox.minX, bbox.minY, bbox.maxX, bbox.maxY, mapCanvas);
                        ctx.moveTo(trPoint.x, trPoint.y);
                        for(let i=1; i<coordinate.length; i++){
                            let trNextPoint = transformCoordinates(coordinate[i][0], coordinate[i][1], bbox.minX, bbox.minY, bbox.maxX, bbox.maxY, mapCanvas);
                            ctx.lineTo(trNextPoint.x , trNextPoint.y );
                        }
                        ctx.closePath();
                        ctx.lineJoin = 'round';
                        ctx.lineCap = 'round';
                        ctx.stroke();
                    });
                }
            }

            async function drawPolyLine(){
                const response = await fetch('/mapData/Hatlar');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const coordinates = await [shapeData.polyCoordinates];

                const mapCanvas = document.getElementById('polyLineMapCanvas');
                const ctx = mapCanvas.getContext('2d');

                if(mapCanvas.getContext){
                    coordinates.forEach(coordinate => {
                        ctx.beginPath();
                        let  trPoint= transformCoordinates(coordinate[0][0], coordinate[0][1], bbox.minX, bbox.minY, bbox.maxX, bbox.maxY, mapCanvas);
                        ctx.moveTo(trPoint.x, trPoint.y);
                        for(let i=1; i<coordinate.length; i++){
                            let trNextPoint = transformCoordinates(coordinate[i][0], coordinate[i][1], bbox.minX, bbox.minY, bbox.maxX, bbox.maxY, mapCanvas);
                            ctx.lineTo(trNextPoint.x , trNextPoint.y );
                        }
                        ctx.lineJoin = 'round';
                        ctx.lineCap = 'round';
                        ctx.closePath();
                        ctx.stroke();
                    });
                }
            }

            async function drawPoint(){
                const response = await fetch('/mapData/Duraklar');
                const shapeData = await response.json();
                const bbox = await shapeData.bbox;
                const coordinates = await shapeData.pointCoordinates;

                const mapCanvas = document.getElementById('pointMapCanvas');
                if(mapCanvas.getContext){
                    const ctx = mapCanvas.getContext('2d');
                    coordinates.forEach(coordinate => {
                        let trPoint = transformCoordinates(coordinate.x, coordinate.y, bbox.minX, bbox.minY, bbox.maxX, bbox.maxY, mapCanvas);
                        ctx.beginPath();
                        ctx.arc(trPoint.x, trPoint.y, 2, 0, 2 * Math.PI);
                        ctx.fill();
                    });
                }
            }

            function transformCoordinates(x, y, minX, minY, maxX, maxY, canvas){
                let transformX = ((maxX - x) / (maxX - minX)) * canvas.width;
                let transformY = ((maxY - y) / (maxY - minY)) * canvas.height;

                return {x : transformX, y: transformY};
            }

            window.onload = drawPoint();
            window.onload = drawPolygon();
            window.onload = drawPolyLine();
        </script>
    </th:head>
    <th:body>
        <canvas id="pointMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
        <canvas id="polyLineMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
        <canvas id="polygonMapCanvas" width="800" height="500" style="border:1px solid"></canvas>
    </th:body>

</html>